<!--내 예약 내역-->


<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>예약 목록</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 40px 0;
    }
    .page-header {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    .page-title {
      color: #667eea;
      font-weight: bold;
      margin: 0;
    }
    .filter-tabs {
      margin-top: 20px;
    }
    .filter-tabs .nav-link {
      color: #666;
      border-radius: 10px;
      margin-right: 10px;
    }
    .filter-tabs .nav-link.active {
      background: #667eea;
      color: white;
    }
    .reservation-card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 20px;
      box-shadow: 0 3px 15px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    .reservation-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 20px rgba(0,0,0,0.15);
    }
    .reservation-id {
      color: #999;
      font-size: 0.9rem;
    }
    .product-name {
      font-size: 1.3rem;
      font-weight: bold;
      color: #333;
      margin: 10px 0;
    }
    .store-name {
      color: #667eea;
      font-weight: 600;
    }
    .status-badge {
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9rem;
      font-weight: 600;
      display: inline-block;
    }
    .status-received {
      background: #d1ecf1;
      color: #0c5460;
    }
    .status-preparing {
      background: #fff3cd;
      color: #856404;
    }
    .status-ready {
      background: #d4edda;
      color: #155724;
    }
    .info-item {
      margin: 8px 0;
      color: #666;
    }
    .btn-status {
      border-radius: 20px;
      padding: 8px 20px;
      margin: 3px;
    }
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: white;
    }
    .empty-state i {
      font-size: 4rem;
      opacity: 0.5;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
<div class="container">
  <div class="page-header">
    <div class="d-flex justify-content-between align-items-center">
      <h2 class="page-title">
        <i class="fas fa-calendar-check"></i>
        <span th:if="${viewType == 'customer'}">내 예약 목록</span>
        <span th:if="${viewType == 'owner'}">가게 예약 관리</span>
      </h2>
      <a th:href="@{/stores}" class="btn btn-outline-primary">
        <i class="fas fa-store"></i> 가게 목록
      </a>
    </div>

    <!-- 필터 탭 -->
    <ul class="nav filter-tabs">
      <li class="nav-item">
        <a class="nav-link" th:classappend="${status == null ? 'active' : ''}"
           th:href="@{/reservations(viewType=${viewType})}">
          전체
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" th:classappend="${status == 'received' ? 'active' : ''}"
           th:href="@{/reservations(viewType=${viewType}, status='received')}">
          접수
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" th:classappend="${status == 'preparing' ? 'active' : ''}"
           th:href="@{/reservations(viewType=${viewType}, status='preparing')}">
          준비중
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" th:classappend="${status == 'ready' ? 'active' : ''}"
           th:href="@{/reservations(viewType=${viewType}, status='ready')}">
          준비완료
        </a>
      </li>
    </ul>
  </div>

  <!-- 예약 목록 -->
  <div th:if="${reservations != null and !reservations.isEmpty()}">
    <div class="reservation-card" th:each="reservation : ${reservations}">
      <div class="row">
        <div class="col-md-8">
          <div class="reservation-id">
            예약번호: #<span th:text="${reservation.id}"></span>
          </div>
          <div class="product-name" th:text="${reservation.product.name}">상품명</div>
          <div class="store-name">
            <i class="fas fa-store"></i>
            <span th:text="${reservation.product.store.name}">가게명</span>
          </div>

          <div class="info-item">
            <i class="fas fa-clock"></i>
            픽업시간: <strong th:text="${#temporals.format(reservation.pickupTime, 'yyyy-MM-dd HH:mm')}"></strong>
          </div>

          <div class="info-item">
            <i class="fas fa-calendar"></i>
            주문일시: <span th:text="${#temporals.format(reservation.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
          </div>

          <!-- 고객 정보 (사장님 화면에만 표시) -->
          <div th:if="${viewType == 'owner'}" class="info-item">
            <i class="fas fa-user"></i>
            고객: <span th:text="${reservation.user.name}">고객명</span>
          </div>
        </div>

        <div class="col-md-4 text-end">
          <!-- 상태 배지 -->
          <div class="mb-3">
                            <span th:if="${reservation.status.name() == 'received'}"
                                  class="status-badge status-received">
                                <i class="fas fa-inbox"></i> 접수
                            </span>
            <span th:if="${reservation.status.name() == 'preparing'}"
                  class="status-badge status-preparing">
                                <i class="fas fa-spinner"></i> 준비중
                            </span>
            <span th:if="${reservation.status.name() == 'ready'}"
                  class="status-badge status-ready">
                                <i class="fas fa-check-circle"></i> 준비완료
                            </span>
          </div>

          <!-- 사장님 상태 변경 버튼 -->
          <div th:if="${viewType == 'owner'}">
            <form th:action="@{/reservations/{id}/status(id=${reservation.id})}"
                  method="post" style="display: inline;">
              <input type="hidden" name="status" value="preparing">
              <button th:if="${reservation.status.name() == 'received'}"
                      type="submit" class="btn btn-warning btn-status btn-sm">
                <i class="fas fa-arrow-right"></i> 준비 시작
              </button>
            </form>

            <form th:action="@{/reservations/{id}/status(id=${reservation.id})}"
                  method="post" style="display: inline;">
              <input type="hidden" name="status" value="ready">
              <button th:if="${reservation.status.name() == 'preparing'}"
                      type="submit" class="btn btn-success btn-status btn-sm">
                <i class="fas fa-check"></i> 준비 완료
              </button>
            </form>
          </div>

          <!-- 예약 상세/취소 버튼 -->
          <div class="mt-2">
            <a th:href="@{/reservations/{id}(id=${reservation.id})}"
               class="btn btn-outline-primary btn-status btn-sm">
              <i class="fas fa-info-circle"></i> 상세
            </a>

            <!-- 고객 취소 버튼 (준비완료 전까지만) -->
            <form th:if="${viewType == 'customer' and reservation.status.name() != 'ready'}"
                  th:action="@{/reservations/{id}/cancel(id=${reservation.id})}"
                  method="post" style="display: inline;"
                  onsubmit="return confirm('예약을 취소하시겠습니까?');">
              <button type="submit" class="btn btn-outline-danger btn-status btn-sm">
                <i class="fas fa-times"></i> 취소
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 빈 상태 -->
  <div th:if="${reservations == null or reservations.isEmpty()}" class="empty-state">
    <i class="fas fa-calendar-times"></i>
    <h4>예약 내역이 없습니다</h4>
    <p th:if="${viewType == 'customer'}">가게에서 상품을 예약해보세요!</p>
    <p th:if="${viewType == 'owner'}">아직 접수된 예약이 없습니다</p>
    <a th:href="@{/stores}" class="btn btn-light mt-3">
      <i class="fas fa-store"></i> 가게 둘러보기
    </a>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>