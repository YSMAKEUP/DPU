<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>가게 상세</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    body {
      background: #f8f9fa;
    }
    .header-section {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 40px 0;
      margin-bottom: 30px;
    }
    .store-header {
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }
    .store-title {
      font-size: 2rem;
      font-weight: bold;
      color: #667eea;
      margin-bottom: 20px;
    }
    .info-item {
      margin-bottom: 15px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 10px;
    }
    .pickup-status {
      padding: 15px;
      border-radius: 15px;
      text-align: center;
      font-weight: bold;
      margin-top: 20px;
    }
    .pickup-available {
      background: #d4edda;
      color: #155724;
    }
    .pickup-unavailable {
      background: #f8d7da;
      color: #721c24;
    }
    .products-section {
      margin-top: 40px;
    }
    .product-card {
      background: white;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 15px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    .product-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    }
    .product-name {
      font-size: 1.3rem;
      font-weight: bold;
      color: #333;
      margin-bottom: 10px;
    }
    .product-price {
      font-size: 1.5rem;
      color: #667eea;
      font-weight: bold;
    }
    .stock-badge {
      padding: 5px 12px;
      border-radius: 15px;
      font-size: 0.85rem;
      font-weight: 600;
    }
    .stock-available {
      background: #d4edda;
      color: #155724;
    }
    .stock-low {
      background: #fff3cd;
      color: #856404;
    }
    .stock-out {
      background: #f8d7da;
      color: #721c24;
    }
    .btn-manage {
      border-radius: 20px;
      padding: 8px 20px;
    }
  </style>
</head>
<body>
<div class="header-section">
  <div class="container">
    <a th:href="@{/stores}" class="btn btn-light mb-3">
      <i class="fas fa-arrow-left"></i> 목록으로
    </a>
  </div>
</div>

<div class="container">
  <div class="store-header">
    <div class="row">
      <div class="col-md-8">
        <h1 class="store-title" th:text="${store.name}">가게 이름</h1>

        <div class="info-item">
          <i class="fas fa-map-marker-alt text-primary"></i>
          <strong>주소:</strong> <span th:text="${store.address}">주소</span>
        </div>

        <div class="info-item">
          <i class="fas fa-clock text-primary"></i>
          <strong>영업시간:</strong>
          <span th:text="${store.openTime} + ' ~ ' + ${store.closeTime}">영업시간</span>
        </div>

        <div class="info-item" th:if="${store.closedDay != null}">
          <i class="fas fa-calendar-times text-primary"></i>
          <strong>정기휴무:</strong>
          <span th:switch="${store.closedDay}">
                            <span th:case="1">월요일</span>
                            <span th:case="2">화요일</span>
                            <span th:case="3">수요일</span>
                            <span th:case="4">목요일</span>
                            <span th:case="5">금요일</span>
                            <span th:case="6">토요일</span>
                            <span th:case="7">일요일</span>
                        </span>
        </div>

        <div class="info-item">
          <i class="fas fa-stopwatch text-primary"></i>
          <strong>픽업 마감:</strong>
          영업 종료 <span th:text="${store.pickupCutoffMinutes != null ? store.pickupCutoffMinutes : 30}">30</span>분 전
        </div>
      </div>

      <div class="col-md-4">
        <div th:if="${isPickupAvailable}" class="pickup-status pickup-available">
          <i class="fas fa-check-circle fa-2x mb-2"></i>
          <div>픽업 주문 가능</div>
        </div>
        <div th:unless="${isPickupAvailable}" class="pickup-status pickup-unavailable">
          <i class="fas fa-times-circle fa-2x mb-2"></i>
          <div>픽업 주문 불가</div>
          <small>영업시간이 아니거나 마감시간이 지났습니다</small>
        </div>

        <!-- 사장님 전용 버튼 (로그인된 사용자가 owner인 경우) -->
        <div th:if="${isOwner}" class="mt-3">
          <a th:href="@{/products/new(storeId=${store.id})}" class="btn btn-primary w-100 btn-manage">
            <i class="fas fa-plus"></i> 상품 추가
          </a>
        </div>
      </div>
    </div>
  </div>

  <div class="products-section">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h3><i class="fas fa-birthday-cake"></i> 메뉴</h3>
    </div>

    <div th:if="${products != null and !products.isEmpty()}">
      <div class="product-card" th:each="product : ${products}">
        <div class="row align-items-center">
          <div class="col-md-6">
            <div class="product-name" th:text="${product.name}">상품명</div>
            <div class="text-muted">
              <small>등록일: <span th:text="${#temporals.format(product.createdAt, 'yyyy-MM-dd')}"></span></small>
            </div>
          </div>
          <div class="col-md-3 text-center">
            <div class="product-price" th:text="${#numbers.formatInteger(product.price, 0, 'COMMA')} + '원'">가격</div>
            <div class="mt-2">
                                <span th:if="${product.quantity > 10}" class="stock-badge stock-available">
                                    재고: <span th:text="${product.quantity}"></span>개
                                </span>
              <span th:if="${product.quantity > 0 and product.quantity <= 10}" class="stock-badge stock-low">
                                    재고: <span th:text="${product.quantity}"></span>개 (품절임박)
                                </span>
              <span th:if="${product.quantity == 0 or product.soldOut}" class="stock-badge stock-out">
                                    품절
                                </span>
            </div>
          </div>
          <div class="col-md-3 text-end">
            <a th:href="@{/products/{id}(id=${product.id})}" class="btn btn-outline-primary btn-manage">
              <i class="fas fa-info-circle"></i> 상세보기
            </a>
            <a th:if="${isOwner}" th:href="@{/products/{id}/edit(id=${product.id})}"
               class="btn btn-outline-secondary btn-manage mt-2">
              <i class="fas fa-edit"></i> 수정
            </a>
          </div>
        </div>
      </div>
    </div>

    <div th:if="${products == null or products.isEmpty()}" class="text-center py-5">
      <i class="fas fa-box-open" style="font-size: 4rem; color: #ccc;"></i>
      <h5 class="mt-3 text-muted">등록된 메뉴가 없습니다</h5>
      <p th:if="${isOwner}" class="text-muted">상품을 추가해보세요!</p>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>